# 首先创建 Secret 存储 SMTP 密码
# kubectl create secret generic smtp-credentials \
#   --from-literal=password='your-smtp-password' \
#   -n default

apiVersion: podmonitor.pod-monitor.io/v1
kind: PodMonitor
metadata:
  name: podmonitor-with-secret
  namespace: default
spec:
  namespaces:
    - default
    - production
  
  labelSelector:
    app: batch-job
  
  maxRunDurationSeconds: 3600
  checkIntervalSeconds: 60
  # ⚠️ 警告：设置为 true 时，Operator 会自动删除超过最大运行时长的 Pod
  # 这可能导致数据丢失或服务中断，请在生产环境谨慎使用
  autoCleanup: false
  gracePeriodSeconds: 300

  emailNotification:
    enabled: true
    recipients:
      - ops-team@example.com
      - devops@example.com
    smtpServer: smtp.example.com
    smtpPort: 587
    from: podmonitor@example.com
    username: podmonitor@example.com
    # 注意：密码应该从 Secret 中读取，通过环境变量注入到 Operator
    # 或者使用 External Secrets Operator 等工具管理
    password: ""  # 将通过环境变量或 Secret 注入
    useTLS: true
    subject: "PodMonitor 僵尸 Pod 告警"

